{
  "openapi": "3.0.0",
  "info": {
    "title": "Auth Practice API",
    "version": "1.0.0",
    "description": "API documentation cho ứng dụng chat với xác thực người dùng"
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string",
            "description": "User ID"
          },
          "username": {
            "type": "string",
            "description": "Tên đăng nhập"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email người dùng"
          },
          "displayName": {
            "type": "string",
            "description": "Tên hiển thị"
          },
          "avatarUrl": {
            "type": "string",
            "nullable": true,
            "description": "URL avatar"
          },
          "avatarId": {
            "type": "string",
            "nullable": true,
            "description": "Avatar ID"
          },
          "bio": {
            "type": "string",
            "maxLength": 500,
            "nullable": true,
            "description": "Tiểu sử"
          },
          "phone": {
            "type": "string",
            "nullable": true,
            "description": "Số điện thoại"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Friend": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "userA": {
            "$ref": "#/components/schemas/User"
          },
          "userB": {
            "$ref": "#/components/schemas/User"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "FriendRequest": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "from": {
            "$ref": "#/components/schemas/User"
          },
          "to": {
            "$ref": "#/components/schemas/User"
          },
          "message": {
            "type": "string",
            "maxLength": 300,
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Participant": {
        "type": "object",
        "properties": {
          "userId": {
            "$ref": "#/components/schemas/User"
          },
          "joinedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Group": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "createdBy": {
            "$ref": "#/components/schemas/User"
          }
        }
      },
      "LastMessage": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "content": {
            "type": "string",
            "nullable": true
          },
          "senderId": {
            "$ref": "#/components/schemas/User"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Conversation": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["direct", "group"]
          },
          "participants": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Participant"
            }
          },
          "group": {
            "$ref": "#/components/schemas/Group",
            "nullable": true
          },
          "lastMessageAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "seenBy": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "lastMessage": {
            "$ref": "#/components/schemas/LastMessage",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Message": {
        "type": "object",
        "properties": {
          "_id": {
            "type": "string"
          },
          "conversationId": {
            "type": "string"
          },
          "senderId": {
            "$ref": "#/components/schemas/User"
          },
          "content": {
            "type": "string"
          },
          "imgUrl": {
            "type": "string",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Error": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "statusCode": {
            "type": "integer"
          }
        }
      }
    }
  },
  "paths": {
    "/api/auth/signup": {
      "post": {
        "tags": ["Auth"],
        "summary": "Đăng ký tài khoản mới",
        "description": "Tạo tài khoản người dùng mới",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["username", "email", "password", "firstName", "lastName"],
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "Tên đăng nhập"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email người dùng"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "description": "Mật khẩu"
                  },
                  "firstName": {
                    "type": "string",
                    "description": "Tên"
                  },
                  "lastName": {
                    "type": "string",
                    "description": "Họ"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Đăng ký thành công"
          },
          "400": {
            "description": "Dữ liệu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "409": {
            "description": "Username hoặc email đã tồn tại",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/signin": {
      "post": {
        "tags": ["Auth"],
        "summary": "Đăng nhập",
        "description": "Đăng nhập vào hệ thống",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["username", "password"],
                "properties": {
                  "username": {
                    "type": "string",
                    "description": "Tên đăng nhập"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "description": "Mật khẩu"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Đăng nhập thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Đăng nhập thành công"
                    },
                    "accessToken": {
                      "type": "string",
                      "description": "JWT access token"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Thông tin đăng nhập không đúng",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "tags": ["Auth"],
        "summary": "Đăng xuất",
        "description": "Đăng xuất khỏi hệ thống",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Đăng xuất thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Đăng xuất thành công"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/auth/refresh": {
      "post": {
        "tags": ["Auth"],
        "summary": "Làm mới access token",
        "description": "Lấy access token mới bằng refresh token từ cookie",
        "responses": {
          "200": {
            "description": "Làm mới token thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string",
                      "description": "JWT access token mới"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Refresh token không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/users/me": {
      "get": {
        "tags": ["Users"],
        "summary": "Lấy thông tin người dùng hiện tại",
        "description": "Lấy thông tin của người dùng đang đăng nhập",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lấy thông tin user thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Lấy thông tin user thành công"
                    },
                    "user": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/users/test": {
      "get": {
        "tags": ["Users"],
        "summary": "Test endpoint",
        "description": "Endpoint test để kiểm tra authentication",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "204": {
            "description": "Success"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/friends": {
      "get": {
        "tags": ["Friends"],
        "summary": "Lấy danh sách bạn bè",
        "description": "Lấy tất cả bạn bè của người dùng hiện tại",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lấy danh sách bạn bè thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Lấy danh sách bạn bè thành công"
                    },
                    "friends": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Friend"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/friends/requests": {
      "get": {
        "tags": ["Friends"],
        "summary": "Lấy danh sách yêu cầu kết bạn",
        "description": "Lấy tất cả yêu cầu kết bạn đã nhận",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lấy danh sách yêu cầu kết bạn thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Lấy danh sách yêu cầu kết bạn thành công"
                    },
                    "friendRequests": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/FriendRequest"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Friends"],
        "summary": "Gửi yêu cầu kết bạn",
        "description": "Gửi yêu cầu kết bạn đến người dùng khác",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["to"],
                "properties": {
                  "to": {
                    "type": "string",
                    "description": "ID người dùng nhận yêu cầu"
                  },
                  "message": {
                    "type": "string",
                    "maxLength": 300,
                    "description": "Tin nhắn kèm theo yêu cầu"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Gửi yêu cầu kết bạn thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Gửi yêu cầu kết bạn thành công"
                    },
                    "request": {
                      "$ref": "#/components/schemas/FriendRequest"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Người dùng không tồn tại",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/friends/requests/{requestId}/accept": {
      "post": {
        "tags": ["Friends"],
        "summary": "Chấp nhận yêu cầu kết bạn",
        "description": "Chấp nhận yêu cầu kết bạn từ người dùng khác",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "requestId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID của yêu cầu kết bạn"
          }
        ],
        "responses": {
          "200": {
            "description": "Chấp nhận yêu cầu kết bạn thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Chấp nhận yêu cầu kết bạn thành công"
                    },
                    "newFriend": {
                      "$ref": "#/components/schemas/Friend"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Yêu cầu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Yêu cầu không tồn tại",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/friends/requests/{requestId}/decline": {
      "post": {
        "tags": ["Friends"],
        "summary": "Từ chối yêu cầu kết bạn",
        "description": "Từ chối yêu cầu kết bạn từ người dùng khác",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "requestId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID của yêu cầu kết bạn"
          }
        ],
        "responses": {
          "204": {
            "description": "Từ chối yêu cầu kết bạn thành công"
          },
          "400": {
            "description": "Yêu cầu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Yêu cầu không tồn tại",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/conversations": {
      "get": {
        "tags": ["Conversations"],
        "summary": "Lấy danh sách cuộc trò chuyện",
        "description": "Lấy tất cả cuộc trò chuyện của người dùng hiện tại",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Cuộc trò chuyện đã được lấy thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Cuộc trò chuyện đã được lấy thành công"
                    },
                    "conversations": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Conversation"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Conversations"],
        "summary": "Tạo cuộc trò chuyện mới",
        "description": "Tạo cuộc trò chuyện mới (direct hoặc group)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["direct", "group"],
                    "description": "Loại cuộc trò chuyện"
                  },
                  "name": {
                    "type": "string",
                    "description": "Tên nhóm (chỉ dùng cho group)"
                  },
                  "memberIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Danh sách ID thành viên"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Cuộc trò chuyện đã được tạo thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Cuộc trò chuyện đã được tạo thành công"
                    },
                    "conversation": {
                      "$ref": "#/components/schemas/Conversation"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/conversations/{conversationId}/messages": {
      "get": {
        "tags": ["Conversations"],
        "summary": "Lấy tin nhắn của cuộc trò chuyện",
        "description": "Lấy danh sách tin nhắn trong cuộc trò chuyện với phân trang",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "conversationId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID của cuộc trò chuyện"
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 20
            },
            "description": "Số lượng tin nhắn tối đa"
          },
          {
            "name": "cursor",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "description": "Cursor để phân trang"
          }
        ],
        "responses": {
          "200": {
            "description": "Tin nhắn đã được lấy thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Tin nhắn đã được lấy thành công"
                    },
                    "messages": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Message"
                      }
                    },
                    "nextCursor": {
                      "type": "string",
                      "nullable": true,
                      "description": "Cursor cho trang tiếp theo"
                    },
                    "hasMore": {
                      "type": "boolean",
                      "description": "Còn tin nhắn để load thêm không"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Cuộc trò chuyện không tồn tại",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/messages/direct": {
      "post": {
        "tags": ["Messages"],
        "summary": "Gửi tin nhắn trực tiếp",
        "description": "Gửi tin nhắn đến một người dùng cụ thể",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["recipientId", "content"],
                "properties": {
                  "recipientId": {
                    "type": "string",
                    "description": "ID người nhận"
                  },
                  "content": {
                    "type": "string",
                    "description": "Nội dung tin nhắn"
                  },
                  "conversationId": {
                    "type": "string",
                    "nullable": true,
                    "description": "ID cuộc trò chuyện (nếu đã có)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Gửi tin nhắn thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "$ref": "#/components/schemas/Message"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "Không phải bạn bè",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/messages/group": {
      "post": {
        "tags": ["Messages"],
        "summary": "Gửi tin nhắn nhóm",
        "description": "Gửi tin nhắn vào cuộc trò chuyện nhóm",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["conversationId", "content"],
                "properties": {
                  "conversationId": {
                    "type": "string",
                    "description": "ID cuộc trò chuyện nhóm"
                  },
                  "content": {
                    "type": "string",
                    "description": "Nội dung tin nhắn"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Gửi tin nhắn thành công",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "$ref": "#/components/schemas/Message"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dữ liệu không hợp lệ",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "403": {
            "description": "Không phải thành viên nhóm",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  }
}
